const tt={LB:"{",RB:"}",STR:"'",IDT:"?",SEMI:";",CLN:":",EOF:"end"};class Lexer{tk(t,e){return{value:t,type:e}}is_char(t){return/^[A-Za-z_-]+$/.test(t)}skip(t){return" "==t||"\n"==t||"\t"==t||"\r"==t}error(t,e){this.err=!0,this.et=`${t} on\n word: ${e}`,console.error(this.et)}constructor(t){this.err=!1,this.et="",this.code=t}tokenizer(){let t=[];const e=this.code.split(""),s=e.length;for(console.log(e);e.length>0;)if(this.skip(e[0]))e.shift();else if(";"==e[0])t.push(this.tk(e.shift(),tt.SEMI));else if(":"==e[0])t.push(this.tk(e.shift(),tt.CLN));else if("{"==e[0])t.push(this.tk(e.shift(),tt.LB));else if("}"==e[0])t.push(this.tk(e.shift(),tt.RB));else if("/"==e[0])if(e.shift(),"*"==e[0]){for(e.shift();e.length>0&&"*"!==e[0];)e.shift();e.shift(),e.shift()}else this.error("Invalid character",s-e.length,e[0]),e.shift();else if('"'==e[0]){e.shift();let s="";for(;e.length>0&&'"'!==e[0];)"\\"==e[0]&&(e.shift(),e+=e.shift()),s+=e.shift();e.shift(),t.push(this.tk(s,tt.STR))}else if(this.is_char(e[0])){let s="";for(;e.length>0&&this.is_char(e[0]);)s+=e.shift();t.push(this.tk(s,tt.IDT))}else this.error("Invalid character",s-e.length,e[0]),e.shift();return t.push(this.tk("EOF",tt.EOF)),t}}class Parser{eof(){return this.tokens[0].type!=tt.EOF}at(){return this.tokens[0]}eat(){return this.tokens.shift()}expect(t){const e=this.tokens.shift();if(!e||e.type!=t)throw this.err=!0,this.et="Expecting: "+t+" BRO",console.error(this.et),"Expecting: "+t+" BRO";return e}unexpect(t){const e=this.tokens[0];return e&&e.type==t?this.eat():e}constructor(t){this.tokens=t,this.err=!1}parse_utils(){let t={},e=this.expect(tt.IDT).value;if(this.eat().type==tt.CLN){let s=this.eat().value;t.type="PROP",t.name=e,t.value=s,this.unexpect(tt.SEMI)}else t=this.parse_child(),t.name=e;return t}parse_child(){let t={type:"ELEMENT",name:"",utils:[]};for(;this.at().type!=tt.RB&&this.eof();){let e=this.parse_utils();t.utils.push(e)}return this.expect(tt.RB),t}parse_parent(){let t={type:"ELEMENT",name:"",utils:[]};for(t.name=this.expect(tt.IDT).value,this.expect(tt.LB);this.at().type!=tt.RB&&this.eof();){let e=this.parse_utils();t.utils.push(e)}return this.expect(tt.RB),t}parse_tk(){return this.parse_parent()}AST(){let t={type:"BODY",value:[]};for(;this.eof()&&!this.err;){let e=this.parse_tk();t.value.push(e)}return this.err?(console.error(this.et),0):t}}class Eval{eval_element(t,e){if("ELEMENT"!=e.type)return 0;let s=document.createElement(e.name);for(;e.utils.length>0;){if("PROP"==e.utils[0].type)try{e.utils[0].name.startsWith("attr-")?s.setAttribute(e.utils[0].name.replace("attr-",""),e.utils[0].value):s[e.utils[0].name]=e.utils[0].value}catch(t){this.err=!0,this.et=t}else"ELEMENT"==e.utils[0].type&&this.eval_element(s,e.utils[0]);e.utils.shift()}t.appendChild(s)}eval_body(t){for(;t.value.length>0;)this.eval_element(this.main,t.value.shift());return this.main}constructor(t,e){this.ast=t,this.err=!1,this.et="",this.main=e||document.createElement("main"),this.hasParent=!!e,e instanceof HTMLElement||!this.hasParent||(this.err=!0,this.et=JSON.stringify(e)+" is not a valid dom element")}run(){this.hasParent?this.eval_body(this.ast):document.body.appendChild(this.eval_body(this.ast))}}class HTSS{err(t,e){let s=document.createElement("dialog");s.open="true",s.setAttribute("style","background-color:black;color:red;translate: 0px -50%;font-family:monospace;top:50%;"),s.innerHTML=`<h1>${e}:</h1><h3>${t}</h3>`,document.body.appendChild(s)}constructor(t,e){try{let s=new Lexer(t),i=s.tokenizer();if(console.log(i),s.err)return this.err(s.et,"LEXEICAL ERROR"),0;let r=new Parser(i),h=r.AST();if(console.log(h),r.err)return this.err(r.et,"AST ERROR"),0;let l=new Eval(h,e);if(l.err)return this.err(l.et,"RUNTIME ERROR"),0;let n=l.run();console.log(n)}catch(t){this.err(t,"ERROR")}}}